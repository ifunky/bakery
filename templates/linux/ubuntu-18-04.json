{
  "variables": {
    "region": "",
    "vpc_name": "",
    "subnet_name": "",
    "destination_regions": "",
    "template_name": "ubuntu-18-04"
  },  
  "min_packer_version": "1.4.2",
  "builders": [
      {
        "ami_description": "Base Centos V1.0",
        "ami_name": "ubuntu-1804-base-server-1.0.{{isotime \"200601021504\"}}",
        "communicator": "ssh",
        "ebs_optimized": true,
        "ena_support": true,
        "sriov_support": true,
        "instance_type": "t3a.small",
        "ami_regions": "{{user `destination_regions`}}",
        "region": "{{user `region`}}",
        "launch_block_device_mappings" : [
          {
             "device_name" : "/dev/sda1",
             "delete_on_termination" : true,
             "volume_size" : 30,
             "volume_type" : "gp2"
          },
          {
            "encrypted" : false,
            "device_name" : "xvdf",
             "volume_size" : 50,
             "delete_on_termination" : true,
             "volume_type" : "gp2"
          }    
       ],
       "ami_block_device_mappings" : [
          {
            "encrypted" : false,
            "device_name" : "xvdf",
             "volume_size" : 30,
             "delete_on_termination" : true,
             "volume_type" : "gp2"
          }
        ],     
        "vpc_filter": {
          "filters": {
            "tag:Name": "{{user `vpc_name`}}",
            "isDefault": "false"
          }
        },
        "subnet_filter": {
          "filters": {
            "tag:Name": "{{user `subnet_name`}}"
          },
          "random": true
      },                     
        "source_ami_filter": {
          "filters": {
            "virtualization-type": "hvm",
            "name": "ubuntu/images/hvm-ssd/ubuntu-bionic-18.04-amd64-server-*",
            "root-device-type": "ebs"
          },
          "owners": [
            "099720109477"
          ],
          "most_recent": true
        },
        "ssh_pty": true,
        "ssh_username": "ubuntu",
        "tags": {},
        "type": "amazon-ebs"
      }
    ],
    "provisioners": [
      {
        "execute_command": "echo 'ubuntu' | {{.Vars}} sudo -S -E sh -eux '{{.Path}}'",
        "type": "shell",
        "scripts": [
          "scripts/ubuntu/upgrade.sh"
        ]
      }
    ],
    "post-processors": [
      {
        "type": "manifest",
        "output": "{{user `template_name`}}.manifest",
        "strip_path": true
      }
    ]
  }